<?php
/**
 */

namespace execut\pages\controllers;


use execut\actions\Action;
use execut\actions\action\adapter\Delete;
use execut\actions\action\adapter\Edit;
use execut\actions\action\adapter\GridView;
use execut\crud\fields\Field;
use execut\pages\action\adapter\ShowPage;
use execut\pages\models\Page;
use execut\navigation\Behavior;
use yii\db\Expression;
use yii\helpers\ArrayHelper;
use yii\web\Controller;
use yii\web\ErrorAction;

class FrontendController extends Controller
{
    public function behaviors()
    {
//        if (YII_ENV === 'dev') {
//            return [];
//        }

        $time = \yii::$app->getModule('pages')->getLastModificationTime();

        return [
            'httpCache' => [
                'class' => 'yii\filters\HttpCache',
                'only' => ['index'],
                'lastModified' => function () use ($time) {
                    return $time;
                },
                'etagSeed' => function () use ($time) {
                    return $time;
                },
            ],
            'pageCache' => [
                'class' => 'yii\filters\PageCache',
                'only' => ['index'],
                'duration' => 0,
                'dependency' => [
                    'class' => 'yii\caching\TagDependency',
                    'tags' => [
                        'pages',
                        $time,
                    ],
                ],
                'variations' => [
                    \Yii::$app->request->url . $time,
                ]
            ],
        ];
    }

    public function actions()
    {
        return ArrayHelper::merge(parent::actions(), [
            'index' => [
                'class' => Action::class,
                'adapter' => [
                    'class' => ShowPage::class,
                ],
                'view' => 'index',
            ],
            'error' => [
                'class' => ErrorAction::class,
            ],
        ]); // TODO: Change the autogenerated stub
    }
}